// –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
function writeData() {
  set(ref(database, 'users/user1'), {
    name: '–ò–≤–∞–Ω',
    age: 30
  });
}

// –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
function readData() {
  const userRef = ref(database, 'users/user1');
  onValue(userRef, (snapshot) => {
    const data = snapshot.val();
    console.log(data);
    // –û–±–Ω–æ–≤–ª—è–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–¥–µ—Å—å
  });
}
// –ú–∞—Å—Å–∏–≤—ã –¥–∞–Ω–Ω—ã—Ö
const channels = [];
const videos = [];
let currentChannelId = null;

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ
function updateChannelSelect() {
  const select = document.getElementById('channelSelect');
  select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª --</option>';
  
  channels.forEach(c => {
    const option = document.createElement('option');
    option.value = c.id;
    option.textContent = c.name;
    select.appendChild(option);
  });
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
document.getElementById('createChannelForm').addEventListener('submit', e => {
  e.preventDefault();
  
  const nameInput = document.getElementById('channelName');
  const name = nameInput.value.trim();
  
  if (!name) {
    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞');
    return;
  }

  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª
  const newChannel = {
    id: Date.now(),
    name,
  };
  
  channels.push(newChannel);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤
  updateChannelSelect();
  
  // –°–æ–æ–±—â–µ–Ω–∏–µ
  document.getElementById('channelMessage').textContent = `–ö–∞–Ω–∞–ª "${name}" —Å–æ–∑–¥–∞–Ω!`;
  
  // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
  nameInput.value = '';

});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞–Ω–∞–ª–∞
document.getElementById('channelSelect').addEventListener('change', e => {
  currentChannelId = e.target.value ? Number(e.target.value) : null;
});

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
document.getElementById('videoUploadForm').addEventListener('submit', e => {
  e.preventDefault();

 if (!currentChannelId) {
   alert('–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –≤–∏–¥–µ–æ.');
   return;
 }

 const fileInput = document.getElementById('videoFile');
 const title = document.getElementById('videoTitle').value.trim();
 const desc = document.getElementById('videoDescription').value.trim();

 if (!fileInput.files[0]) {
   alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.');
   return;
 }

 const url = URL.createObjectURL(fileInput.files[0]);
 const videoID = Date.now();

 const newVideo = {
   id: videoID,
   title,
   desc,
   url,
   likes: {},
   countLikes:0,
   channelId: currentChannelId,
 };

 videos.push(newVideo);
 renderVideos();

 // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
 document.getElementById('videoUploadForm').reset();
});

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–∏–¥–µ–æ
function renderVideos() {
 const container = document.getElementById('videosContainer');
 container.innerHTML='';

 for (let v of videos) {
   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
   if (currentChannelId && v.channelId !== currentChannelId) continue;

   // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
   let channelName='–û–±—â–∏–π —Ä–∞–∑–¥–µ–ª';
   if (v.channelId) {
     const ch=channels.find(c=>c.id===v.channelId);
     if (ch) channelName=ch.name;
   }

   const div=document.createElement('div');
   div.className='video';

   div.innerHTML=`
     <h4>${v.title}</h4>
     <p><strong>–ö–∞–Ω–∞–ª:</strong> ${channelName}</p>
     <p>${v.desc}</p>
     <video src="${v.url}" width=400 controls></video><br/>
     <button class='like-btn' data-id='${v.id}'>üëç</button> 
     <span class='like-count'>${v.countLikes}</span> –ª–∞–π–∫–æ–≤
     `;

   // –õ–∞–π–∫ –∫–Ω–æ–ø–∫–∞
   div.querySelector('.like-btn').onclick=()=>{
     if(!currentUser){
       alert("–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫–∏");
       return;
     }
     if(v.likes[currentUser.email]){
       alert("–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫ —ç—Ç–æ–º—É –≤–∏–¥–µ–æ");
       return;
     }
     v.likes[currentUser.email]=true;
     v.countLikes++;
     renderVideos();
   };

   container.appendChild(div);
 }
}

// –î–ª—è —Ç–µ—Å—Ç–∞ ‚Äî —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–º–æ–∂–µ—Ç–µ —É–±—Ä–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å)
const currentUser={email:'test@example.com'};

// –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
updateChannelSelect();